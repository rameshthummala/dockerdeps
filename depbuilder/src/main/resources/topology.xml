<?xml version="1.0" encoding="UTF-8"?>
<topology name="QA">

	<logicalgroup name="DB">
		<node name="MasterDB">
			<type name="MySQLDB" />
			<services>
				<service>
					<port>3306</port>
					<customattr>
						<schema type="master">proddata</schema>
					</customattr>
					<consumers>
						<consumer>SlaveDB</consumer>
					</consumers>
				</service>
			</services>
		</node>
		<node name="SlaveDB">
			<type name="MySQLDB" />
			<service>
				<port>3306</port>
				<consumers>
					<consumer>SolrIndexer</consumer>
				</consumers>
				<customattr>
					<schema type="slave">proddata</schema>
				</customattr>
			</service>
		</node>
	</logicalgroup>
	<logicalgroup name="SearcherIndexers">
		<node name="Indexer">
			<type name="Solr" />
			<service>
				<port>8080</port>
				<relativeURL>/solr</relativeURL>
				<consumers>
					<consumer>APISearcher</consumer>
				</consumers>
			</service>
		</node>
		<node name="APISearcher">
			<count>2</count>
			<type name="Solr" />
			<service>
				<port>8080</port>
				<relativeURL>/solr</relativeURL>
			</service>
		</node>
	</logicalgroup>


	<logicalgroup name="Cacheloaders">
		<node name="APICache">
			<count>2</count>
			<type name="CouchBase" />
			<service>
				<port>8091</port>
				<relativeURL>/</relativeURL>
				<consumers>
					<consumer>APICacheLoader</consumer>
				</consumers>
			</service>
		</node>
	</logicalgroup>
	
	<logicalgroup name="Zookeepers">
		<node name="SolrCloudZookeeper">
			<count quorum="yes">3</count>
			<type name="Zookeeper" />
			<service>
				<port>2181</port>
				<relativeURL></relativeURL>
				<consumers>
					<consumer>APIIndexer</consumer>
				</consumers>
			</service>
		</node>
	</logicalgroup>

	<logicalgroup name="MessagingQueues">
		<node name="APIRabbitMQ">
			<count>2</count>
			<type name="RabbitMQ" />
			<service>
				<port>15672</port>
				<relativeURL>/#/queues</relativeURL>
				<consumers>
					<consumer>APIApp</consumer>
				</consumers>
			</service>
		</node>
	</logicalgroup>
	
	<logicalgroup name="WebServers">
		<node name="APIApache">
			<type name="ApacheHTTPServer" />
			<service>
				<port>80</port>
				<relativeURL>/api</relativeURL>
				<consumers>
					<consumer></consumer>
				</consumers>
			</service>
		</node>
	</logicalgroup>
	
	<logicalgroup name="ContentDeliveryServers">
		<node name="CDN"> 
			<type name="ApacheHTTPServer"/>
			<count>2</count>
			<service>
				<port>80</port>
				<relativeURL>/</relativeURL>
				<consumers>
					<consumer></consumer>
				</consumers>
			</service>
		</node>
	</logicalgroup>
	
	<logicalgroup name="ApplicationServers">
		<node name="APITomcat">
			<count>1</count>
			<type name="ApplicationServer"/>
			<services>
			<service>
				<role>matchapi</role>
				<port>8080</port>
				<relativeURL>/api</relativeURL>
				<consumers>
					<consumer>APIApache</consumer>
				</consumers>
			</service>
			</services>
		</node>
	</logicalgroup>
<topology>
